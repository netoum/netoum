const we="1.3.0";let Z;(function(){const e={};let r;typeof document<"u"&&document.currentScript!==null&&(r=new URL("UNHANDLED",location.href).toString());let t,n=null;function a(){return(n===null||n.byteLength===0)&&(n=new Uint8Array(t.memory.buffer)),n}let o=0;function p(s,h){const f=h(s.length*1,1)>>>0;return a().set(s,f/1),o=s.length,f}e.init_pagefind=function(s){const h=p(s,t.__wbindgen_malloc),f=o;return t.init_pagefind(h,f)>>>0};const c=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},i=typeof c.encodeInto=="function"?function(s,h){return c.encodeInto(s,h)}:function(s,h){const f=c.encode(s);return h.set(f),{read:s.length,written:f.length}};function l(s,h,f){if(f===void 0){const v=c.encode(s),k=h(v.length,1)>>>0;return a().subarray(k,k+v.length).set(v),o=v.length,k}let d=s.length,w=h(d,1)>>>0;const g=a();let u=0;for(;u<d;u++){const v=s.charCodeAt(u);if(v>127)break;g[w+u]=v}if(u!==d){u!==0&&(s=s.slice(u)),w=f(w,d,d=u+s.length*3,1)>>>0;const v=a().subarray(w+u,w+d),k=i(s,v);u+=k.written,w=f(w,d,u,1)>>>0}return o=u,w}e.set_ranking_weights=function(s,h){const f=l(h,t.__wbindgen_malloc,t.__wbindgen_realloc),d=o;return t.set_ranking_weights(s,f,d)>>>0},e.load_index_chunk=function(s,h){const f=p(h,t.__wbindgen_malloc),d=o;return t.load_index_chunk(s,f,d)>>>0},e.load_filter_chunk=function(s,h){const f=p(h,t.__wbindgen_malloc),d=o;return t.load_filter_chunk(s,f,d)>>>0},e.add_synthetic_filter=function(s,h){const f=l(h,t.__wbindgen_malloc,t.__wbindgen_realloc),d=o;return t.add_synthetic_filter(s,f,d)>>>0};let _=null;function y(){return(_===null||_.byteLength===0)&&(_=new Int32Array(t.memory.buffer)),_}const b=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&b.decode();function x(s,h){return s=s>>>0,b.decode(a().subarray(s,s+h))}e.request_indexes=function(s,h){let f,d;try{const u=t.__wbindgen_add_to_stack_pointer(-16),v=l(h,t.__wbindgen_malloc,t.__wbindgen_realloc),k=o;t.request_indexes(u,s,v,k);var w=y()[u/4+0],g=y()[u/4+1];return f=w,d=g,x(w,g)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(f,d,1)}},e.request_filter_indexes=function(s,h){let f,d;try{const u=t.__wbindgen_add_to_stack_pointer(-16),v=l(h,t.__wbindgen_malloc,t.__wbindgen_realloc),k=o;t.request_filter_indexes(u,s,v,k);var w=y()[u/4+0],g=y()[u/4+1];return f=w,d=g,x(w,g)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(f,d,1)}},e.request_all_filter_indexes=function(s){let h,f;try{const g=t.__wbindgen_add_to_stack_pointer(-16);t.request_all_filter_indexes(g,s);var d=y()[g/4+0],w=y()[g/4+1];return h=d,f=w,x(d,w)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(h,f,1)}},e.filters=function(s){let h,f;try{const g=t.__wbindgen_add_to_stack_pointer(-16);t.filters(g,s);var d=y()[g/4+0],w=y()[g/4+1];return h=d,f=w,x(d,w)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(h,f,1)}},e.search=function(s,h,f,d,w){let g,u;try{const U=t.__wbindgen_add_to_stack_pointer(-16),S=l(h,t.__wbindgen_malloc,t.__wbindgen_realloc),T=o,R=l(f,t.__wbindgen_malloc,t.__wbindgen_realloc),F=o,B=l(d,t.__wbindgen_malloc,t.__wbindgen_realloc),N=o;t.search(U,s,S,T,R,F,B,N,w);var v=y()[U/4+0],k=y()[U/4+1];return g=v,u=k,x(v,k)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(g,u,1)}};async function A(s,h){if(typeof Response=="function"&&s instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(s,h)}catch(d){if(s.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",d);else throw d}const f=await s.arrayBuffer();return await WebAssembly.instantiate(f,h)}else{const f=await WebAssembly.instantiate(s,h);return f instanceof WebAssembly.Instance?{instance:f,module:s}:f}}function W(){const s={};return s.wbg={},s}function P(s,h){return t=s.exports,D.__wbindgen_wasm_module=h,_=null,n=null,t}function C(s){if(t!==void 0)return t;const h=W();s instanceof WebAssembly.Module||(s=new WebAssembly.Module(s));const f=new WebAssembly.Instance(s,h);return P(f,s)}async function D(s){if(t!==void 0)return t;typeof s>"u"&&typeof r<"u"&&(s=r.replace(/\.js$/,"_bg.wasm"));const h=W();(typeof s=="string"||typeof Request=="function"&&s instanceof Request||typeof URL=="function"&&s instanceof URL)&&(s=fetch(s));const{instance:f,module:d}=await A(await s,h);return P(f,d)}Z=Object.assign(D,{initSync:C},e)})();var $=Uint8Array,j=Uint16Array,oe=Uint32Array,le=new $([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ce=new $([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),me=new $([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fe=function(e,r){for(var t=new j(31),n=0;n<31;++n)t[n]=r+=1<<e[n-1];for(var a=new oe(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)a[o]=o-t[n]<<5|n;return[t,a]},he=fe(le,2),de=he[0],ye=he[1];de[28]=258,ye[258]=28;var be=fe(ce,0),ve=be[0],ue=new j(32768);for(m=0;m<32768;++m)L=(m&43690)>>>1|(m&21845)<<1,L=(L&52428)>>>2|(L&13107)<<2,L=(L&61680)>>>4|(L&3855)<<4,ue[m]=((L&65280)>>>8|(L&255)<<8)>>>1;var L,m,J=function(e,r,t){for(var n=e.length,a=0,o=new j(r);a<n;++a)e[a]&&++o[e[a]-1];var p=new j(r);for(a=0;a<r;++a)p[a]=p[a-1]+o[a-1]<<1;var c;{c=new j(1<<r);var i=15-r;for(a=0;a<n;++a)if(e[a])for(var l=a<<4|e[a],_=r-e[a],y=p[e[a]-1]++<<_,b=y|(1<<_)-1;y<=b;++y)c[ue[y]>>>i]=l}return c},G=new $(288);for(m=0;m<144;++m)G[m]=8;var m;for(m=144;m<256;++m)G[m]=9;var m;for(m=256;m<280;++m)G[m]=7;var m;for(m=280;m<288;++m)G[m]=8;var m,_e=new $(32);for(m=0;m<32;++m)_e[m]=5;var m,ke=J(G,9),Pe=J(_e,5),H=function(e){for(var r=e[0],t=1;t<e.length;++t)e[t]>r&&(r=e[t]);return r},E=function(e,r,t){var n=r/8|0;return(e[n]|e[n+1]<<8)>>(r&7)&t},Q=function(e,r){var t=r/8|0;return(e[t]|e[t+1]<<8|e[t+2]<<16)>>(r&7)},xe=function(e){return(e+7)/8|0},$e=function(e,r,t){(t==null||t>e.length)&&(t=e.length);var n=new(e.BYTES_PER_ELEMENT==2?j:e.BYTES_PER_ELEMENT==4?oe:$)(t-r);return n.set(e.subarray(r,t)),n},Fe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],M=function(e,r,t){var n=new Error(r||Fe[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,M),!t)throw n;return n},Se=function(e,r,t){var n=e.length;if(!n||t&&t.f&&!t.l)return r||new $(0);var a=!r||t,o=!t||t.i;t||(t={}),r||(r=new $(n*3));var p=function(ne){var ie=r.length;if(ne>ie){var ae=new $(Math.max(ie*2,ne));ae.set(r),r=ae}},c=t.f||0,i=t.p||0,l=t.b||0,_=t.l,y=t.d,b=t.m,x=t.n,A=n*8;do{if(!_){c=E(e,i,1);var W=E(e,i+1,3);if(i+=3,W)if(W==1)_=ke,y=Pe,b=9,x=5;else if(W==2){var s=E(e,i,31)+257,h=E(e,i+10,15)+4,f=s+E(e,i+5,31)+1;i+=14;for(var d=new $(f),w=new $(19),g=0;g<h;++g)w[me[g]]=E(e,i+g*3,7);i+=h*3;for(var u=H(w),v=(1<<u)-1,k=J(w,u),g=0;g<f;){var U=k[E(e,i,v)];i+=U&15;var P=U>>>4;if(P<16)d[g++]=P;else{var S=0,T=0;for(P==16?(T=3+E(e,i,3),i+=2,S=d[g-1]):P==17?(T=3+E(e,i,7),i+=3):P==18&&(T=11+E(e,i,127),i+=7);T--;)d[g++]=S}}var R=d.subarray(0,s),F=d.subarray(s);b=H(R),x=H(F),_=J(R,b),y=J(F,x)}else M(1);else{var P=xe(i)+4,C=e[P-4]|e[P-3]<<8,D=P+C;if(D>n){o&&M(0);break}a&&p(l+C),r.set(e.subarray(P,D),l),t.b=l+=C,t.p=i=D*8,t.f=c;continue}if(i>A){o&&M(0);break}}a&&p(l+131072);for(var B=(1<<b)-1,N=(1<<x)-1,K=i;;K=i){var S=_[Q(e,i)&B],q=S>>>4;if(i+=S&15,i>A){o&&M(0);break}if(S||M(2),q<256)r[l++]=q;else if(q==256){K=i,_=null;break}else{var te=q-254;if(q>264){var g=q-257,z=le[g];te=E(e,i,(1<<z)-1)+de[g],i+=z}var V=y[Q(e,i)&N],Y=V>>>4;V||M(3),i+=V&15;var F=ve[Y];if(Y>3){var z=ce[Y];F+=Q(e,i)&(1<<z)-1,i+=z}if(i>A){o&&M(0);break}a&&p(l+131072);for(var re=l+te;l<re;l+=4)r[l]=r[l-F],r[l+1]=r[l+1-F],r[l+2]=r[l+2-F],r[l+3]=r[l+3-F];l=re}}t.l=_,t.p=K,t.b=l,t.f=c,_&&(c=1,t.m=b,t.d=y,t.n=x)}while(!c);return l==r.length?r:$e(r,0,l)},Ee=new $(0),Ue=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&M(6,"invalid gzip data");var r=e[3],t=10;r&4&&(t+=e[10]|(e[11]<<8)+2);for(var n=(r>>3&1)+(r>>4&1);n>0;n-=!e[t++]);return t+(r&2)},Ie=function(e){var r=e.length;return(e[r-4]|e[r-3]<<8|e[r-2]<<16|e[r-1]<<24)>>>0};function Ae(e,r){return Se(e.subarray(Ue(e),-8),r||new $(Ie(e)))}var Le=typeof TextDecoder<"u"&&new TextDecoder,Me=0;try{Le.decode(Ee,{stream:!0}),Me=1}catch{}var We=Ae,ge=(e,r)=>{if(e.length===0)return 0;let t=[];for(const c of e)t[c.location]=t[c.location]||0,t[c.location]+=c.balanced_score;if(t.length<=r)return 0;let n=t.slice(0,r).reduce((c,i)=>c+i,0),a=n,o=[0];for(let c=0;c<t.length;c++){const i=c+r;a+=(t[i]??0)-(t[c]??0),a>n?(n=a,o=[c]):a===n&&o[o.length-1]===c-1&&o.push(c)}return o[Math.floor(o.length/2)]},pe=(e,r,t,n,a,o)=>{var _;let p=e.includes("​"),c=[];p?c=e.split("​"):c=e.split(/[\r\n\s]+/g);for(let y of n)(_=c[y])!=null&&_.startsWith("<mark>")||(c[y]=`<mark>${c[y]}</mark>`);let i=o??c.length,l=a??0;return i-l<t&&(t=i-l),r+t>i&&(r=i-t),r<l&&(r=l),c.slice(r,r+t).join(p?"":" ").trim()},De=(e,r)=>{var c;const t=e.anchors.filter(i=>{var l;return/h\d/i.test(i.element)&&((l=i.text)==null?void 0:l.length)&&/\S/.test(i.text)}).sort((i,l)=>i.location-l.location),n=[];let a=0,o={title:e.meta.title,url:e.url,weighted_locations:[],locations:[],excerpt:""};const p=i=>{if(o.locations.length){const l=o.weighted_locations.map(b=>({weight:b.weight,balanced_score:b.balanced_score,location:b.location-a})),_=ge(l,r)+a,y=i?Math.min(i-_,r):r;o.excerpt=pe(e.raw_content??"",_,y,o.locations,a,i),n.push(o)}};for(let i of e.weighted_locations)if(!t.length||i.location<t[0].location)o.weighted_locations.push(i),o.locations.push(i.location);else{let l=t.shift();for(p(l.location);t.length&&i.location>=t[0].location;)l=t.shift();let _=e.url;try{if(/^((https?:)?\/\/)/.test(_)){let b=new URL(_);b.hash=l.id,_=b.toString()}else{/^\//.test(_)||(_=`/${_}`);let b=new URL(`https://example.com${_}`);b.hash=l.id,_=b.toString().replace(/^https:\/\/example.com/,"")}}catch{console.error(`Pagefind: Couldn't process ${_} for a search result`)}a=l.location,o={title:l.text,url:_,anchor:l,weighted_locations:[i],locations:[i.location],excerpt:""}}return p((c=t[0])==null?void 0:c.location),n},X=async(e=100)=>new Promise(r=>setTimeout(r,e)),se=class{constructor(e={}){var r;this.version=we,this.backend=Z,this.decoder=new TextDecoder("utf-8"),this.wasm=null,this.basePath=e.basePath||"/pagefind/",this.primary=e.primary||!1,this.primary&&!e.basePath&&this.initPrimary(),/[^\/]$/.test(this.basePath)&&(this.basePath=`${this.basePath}/`),(r=window==null?void 0:window.location)!=null&&r.origin&&this.basePath.startsWith(window.location.origin)&&(this.basePath=this.basePath.replace(window.location.origin,"")),this.baseUrl=e.baseUrl||this.defaultBaseUrl(),/^(\/|https?:\/\/)/.test(this.baseUrl)||(this.baseUrl=`/${this.baseUrl}`),this.indexWeight=e.indexWeight??1,this.excerptLength=e.excerptLength??30,this.mergeFilter=e.mergeFilter??{},this.ranking=e.ranking,this.highlightParam=e.highlightParam??null,this.loaded_chunks={},this.loaded_filters={},this.loaded_fragments={},this.raw_ptr=null,this.searchMeta=null,this.languages=null}initPrimary(){var r;let e=(r=import.meta.url.match(/^(.*\/)pagefind.js.*$/))==null?void 0:r[1];e?this.basePath=e:console.warn(["Pagefind couldn't determine the base of the bundle from the import path. Falling back to the default.","Set a basePath option when initialising Pagefind to ignore this message."].join(`
`))}defaultBaseUrl(){var r;return((r=this.basePath.match(/^(.*\/)_?pagefind/))==null?void 0:r[1])||"/"}async options(e){const r=["basePath","baseUrl","indexWeight","excerptLength","mergeFilter","highlightParam","ranking"];for(const[t,n]of Object.entries(e))if(t==="mergeFilter"){let a=this.stringifyFilters(n),o=await this.getPtr();this.raw_ptr=this.backend.add_synthetic_filter(o,a)}else t==="ranking"?await this.set_ranking(e.ranking):r.includes(t)?(t==="basePath"&&typeof n=="string"&&(this.basePath=n),t==="baseUrl"&&typeof n=="string"&&(this.baseUrl=n),t==="indexWeight"&&typeof n=="number"&&(this.indexWeight=n),t==="excerptLength"&&typeof n=="number"&&(this.excerptLength=n),t==="mergeFilter"&&typeof n=="object"&&(this.mergeFilter=n),t==="highlightParam"&&typeof n=="string"&&(this.highlightParam=n)):console.warn(`Unknown Pagefind option ${t}. Allowed options: [${r.join(", ")}]`)}decompress(e,r="unknown file"){return this.decoder.decode(e.slice(0,12))==="pagefind_dcd"?e.slice(12):(e=We(e),this.decoder.decode(e.slice(0,12))!=="pagefind_dcd"?(console.error(`Decompressing ${r} appears to have failed: Missing signature`),e):e.slice(12))}async set_ranking(e){if(!e)return;let r={term_similarity:e.termSimilarity??null,page_length:e.pageLength??null,term_saturation:e.termSaturation??null,term_frequency:e.termFrequency??null},t=await this.getPtr();this.raw_ptr=this.backend.set_ranking_weights(t,JSON.stringify(r))}async init(e,r){var o;await this.loadEntry();let t=this.findIndex(e),n=t.wasm?t.wasm:"unknown",a=[this.loadMeta(t.hash)];if(r.load_wasm===!0&&a.push(this.loadWasm(n)),await Promise.all(a),this.raw_ptr=this.backend.init_pagefind(new Uint8Array(this.searchMeta)),(o=Object.keys(this.mergeFilter))!=null&&o.length){let p=this.stringifyFilters(this.mergeFilter),c=await this.getPtr();this.raw_ptr=this.backend.add_synthetic_filter(c,p)}this.ranking&&await this.set_ranking(this.ranking)}async loadEntry(){try{let r=await(await fetch(`${this.basePath}pagefind-entry.json?ts=${Date.now()}`)).json();this.languages=r.languages,r.version!==this.version&&(this.primary?console.warn(["Pagefind JS version doesn't match the version in your search index.",`Pagefind JS: ${this.version}. Pagefind index: ${r.version}`,"If you upgraded Pagefind recently, you likely have a cached pagefind.js file.","If you encounter any search errors, try clearing your cache."].join(`
`)):console.warn(["Merging a Pagefind index from a different version than the main Pagefind instance.",`Main Pagefind JS: ${this.version}. Merged index (${this.basePath}): ${r.version}`,"If you encounter any search errors, make sure that both sites are running the same version of Pagefind."].join(`
`)))}catch(e){throw console.error(`Failed to load Pagefind metadata:
${e==null?void 0:e.toString()}`),new Error("Failed to load Pagefind metadata")}}findIndex(e){if(this.languages){let r=this.languages[e];if(r||(r=this.languages[e.split("-")[0]],r))return r;let t=Object.values(this.languages).sort((n,a)=>a.page_count-n.page_count);if(t[0])return t[0]}throw new Error("Pagefind Error: No language indexes found.")}async loadMeta(e){try{let t=await(await fetch(`${this.basePath}pagefind.${e}.pf_meta`)).arrayBuffer();this.searchMeta=this.decompress(new Uint8Array(t),"Pagefind metadata")}catch(r){console.error(`Failed to load the meta index:
${r==null?void 0:r.toString()}`)}}async loadWasm(e){try{const r=`${this.basePath}wasm.${e}.pagefind`;let n=await(await fetch(r)).arrayBuffer();const a=this.decompress(new Uint8Array(n),"Pagefind WebAssembly");if(!a)throw new Error("No WASM after decompression");this.wasm=await this.backend(a)}catch(r){throw console.error(`Failed to load the Pagefind WASM:
${r==null?void 0:r.toString()}`),new Error(`Failed to load the Pagefind WASM:
${r==null?void 0:r.toString()}`)}}async _loadGenericChunk(e,r){try{let n=await(await fetch(e)).arrayBuffer(),a=this.decompress(new Uint8Array(n),e),o=await this.getPtr();this.raw_ptr=this.backend[r](o,a)}catch(t){console.error(`Failed to load the index chunk ${e}:
${t==null?void 0:t.toString()}`)}}async loadChunk(e){if(!this.loaded_chunks[e]){const r=`${this.basePath}index/${e}.pf_index`;this.loaded_chunks[e]=this._loadGenericChunk(r,"load_index_chunk")}return await this.loaded_chunks[e]}async loadFilterChunk(e){if(!this.loaded_filters[e]){const r=`${this.basePath}filter/${e}.pf_filter`;this.loaded_filters[e]=this._loadGenericChunk(r,"load_filter_chunk")}return await this.loaded_filters[e]}async _loadFragment(e){let t=await(await fetch(`${this.basePath}fragment/${e}.pf_fragment`)).arrayBuffer(),n=this.decompress(new Uint8Array(t),`Fragment ${e}`);return JSON.parse(new TextDecoder().decode(n))}async loadFragment(e,r=[],t){this.loaded_fragments[e]||(this.loaded_fragments[e]=this._loadFragment(e));let n=await this.loaded_fragments[e];n.weighted_locations=r,n.locations=r.map(o=>o.location),n.raw_content||(n.raw_content=n.content.replace(/</g,"&lt;").replace(/>/g,"&gt;"),n.content=n.content.replace(/\u200B/g,"")),n.raw_url||(n.raw_url=n.url),n.url=this.processedUrl(n.raw_url,t);const a=ge(r,this.excerptLength);return n.excerpt=pe(n.raw_content,a,this.excerptLength,n.locations),n.sub_results=De(n,this.excerptLength),n}fullUrl(e){return/^(https?:)?\/\//.test(e)?e:`${this.baseUrl}/${e}`.replace(/\/+/g,"/").replace(/^(https?:\/)/,"$1/")}processedUrl(e,r){const t=this.fullUrl(e);if(this.highlightParam===null)return t;let n=r.split(/\s+/);try{let a=new URL(t);for(const o of n)a.searchParams.append(this.highlightParam,o);return a.toString()}catch{try{let o=new URL(`https://example.com${t}`);for(const p of n)o.searchParams.append(this.highlightParam,p);return o.toString().replace(/^https:\/\/example\.com/,"")}catch{return t}}}async getPtr(){for(;this.raw_ptr===null;)await X(50);if(!this.raw_ptr)throw console.error("Pagefind: WASM Error (No pointer)"),new Error("Pagefind: WASM Error (No pointer)");return this.raw_ptr}parseFilters(e){let r={};if(!e)return r;for(const t of e.split("__PF_FILTER_DELIM__")){let[n,a]=t.split(/:(.*)$/);if(r[n]={},a){for(const o of a.split("__PF_VALUE_DELIM__"))if(o){let p=o.match(/^(.*):(\d+)$/);if(p){let[,c,i]=p;r[n][c]=parseInt(i)??i}}}}return r}stringifyFilters(e={}){return JSON.stringify(e)}stringifySorts(e={}){let r=Object.entries(e);for(let[t,n]of r)return r.length>1&&console.warn(`Pagefind was provided multiple sort options in this search, but can only operate on one. Using the ${t} sort.`),n!=="asc"&&n!=="desc"&&console.warn(`Pagefind was provided a sort with unknown direction ${n}. Supported: [asc, desc]`),`${t}:${n}`;return""}async filters(){let e=await this.getPtr(),t=this.backend.request_all_filter_indexes(e).split(" ").filter(a=>a).map(a=>this.loadFilterChunk(a));await Promise.all([...t]),e=await this.getPtr();let n=this.backend.filters(e);return this.parseFilters(n)}async preload(e,r={}){await this.search(e,{...r,preload:!0})}async search(e,r={}){r={verbose:!1,filters:{},sort:{},...r};const t=u=>{r.verbose&&console.log(u)};t(`Starting search on ${this.basePath}`);let n=Date.now(),a=await this.getPtr(),o=e===null;e=e??"";let p=/^\s*".+"\s*$/.test(e);if(p&&t("Running an exact search"),e=e.toLowerCase().trim().replace(/[\.`~!@#\$%\^&\*\(\)\{\}\[\]\\\|:;'",<>\/\?\-]/g,"").replace(/\s{2,}/g," ").trim(),t(`Normalized search term to ${e}`),!(e!=null&&e.length)&&!o)return{results:[],unfilteredResultCount:0,filters:{},totalFilters:{},timings:{preload:Date.now()-n,search:Date.now()-n,total:Date.now()-n}};let c=this.stringifySorts(r.sort);t(`Stringified sort to ${c}`);const i=this.stringifyFilters(r.filters);t(`Stringified filters to ${i}`);let l=this.backend.request_indexes(a,e),_=this.backend.request_filter_indexes(a,i),y=l.split(" ").filter(u=>u).map(u=>this.loadChunk(u)),b=_.split(" ").filter(u=>u).map(u=>this.loadFilterChunk(u));if(await Promise.all([...y,...b]),t("Loaded necessary chunks to run search"),r.preload)return t("Preload — bailing out of search operation now."),null;a=await this.getPtr();let x=Date.now(),A=this.backend.search(a,e,i,c,p);t(`Got the raw search result: ${A}`);let[W,P,C,D]=A.split(/:([^:]*):(.*)__PF_UNFILTERED_DELIM__(.*)$/),s=this.parseFilters(C),h=this.parseFilters(D);t(`Remaining filters: ${JSON.stringify(A)}`);let f=P.length?P.split(" "):[],d=f.map(u=>{let[v,k,U]=u.split("@");t(`Processing result: 
  hash:${v}
  score:${k}
  locations:${U}`);let S=U.length?U.split(",").map(R=>{let[F,B,N]=R.split(">");return{weight:parseInt(F)/24,balanced_score:parseFloat(B),location:parseInt(N)}}):[],T=S.map(R=>R.location);return{id:v,score:parseFloat(k)*this.indexWeight,words:T,data:async()=>await this.loadFragment(v,S,e)}});const w=Date.now()-x,g=Date.now()-n;return t(`Found ${f.length} result${f.length==1?"":"s"} for "${e}" in ${Date.now()-x}ms (${Date.now()-n}ms realtime)`),{results:d,unfilteredResultCount:parseInt(W),filters:s,totalFilters:h,timings:{preload:g-w,search:w,total:g}}}},Te=class{constructor(e={}){this.backend=Z,this.primaryLanguage="unknown",this.searchID=0,this.primary=new se({...e,primary:!0}),this.instances=[this.primary],this.init(e==null?void 0:e.language)}async options(e){await this.primary.options(e)}async init(e){var r;if(document!=null&&document.querySelector){const t=((r=document.querySelector("html"))==null?void 0:r.getAttribute("lang"))||"unknown";this.primaryLanguage=t.toLocaleLowerCase()}await this.primary.init(e||this.primaryLanguage,{load_wasm:!0})}async mergeIndex(e,r={}){if(this.primary.basePath.startsWith(e)){console.warn(`Skipping mergeIndex ${e} that appears to be the same as the primary index (${this.primary.basePath})`);return}let t=new se({primary:!1,basePath:e});for(this.instances.push(t);this.primary.wasm===null;)await X(50);await t.init(r.language||this.primaryLanguage,{load_wasm:!1}),delete r.language,await t.options(r)}mergeFilters(e){const r={};for(const t of e)for(const[n,a]of Object.entries(t))if(r[n]){const o=r[n];for(const[p,c]of Object.entries(a))o[p]=(o[p]||0)+c}else{r[n]=a;continue}return r}async filters(){let e=await Promise.all(this.instances.map(r=>r.filters()));return this.mergeFilters(e)}async preload(e,r={}){await Promise.all(this.instances.map(t=>t.preload(e,r)))}async debouncedSearch(e,r,t){const n=++this.searchID;if(this.preload(e,r),await X(t),n!==this.searchID)return null;const a=await this.search(e,r);return n!==this.searchID?null:a}async search(e,r={}){let t=await Promise.all(this.instances.map(i=>i.search(e,r)));const n=this.mergeFilters(t.map(i=>i.filters)),a=this.mergeFilters(t.map(i=>i.totalFilters)),o=t.map(i=>i.results).flat().sort((i,l)=>l.score-i.score),p=t.map(i=>i.timings),c=t.reduce((i,l)=>i+l.unfilteredResultCount,0);return{results:o,unfilteredResultCount:c,filters:n,totalFilters:a,timings:p}}},I=void 0,ee=void 0,O=()=>{I||(I=new Te(ee??{}))},Re=async e=>{I?await I.options(e):ee=e},Ce=async()=>{O()},qe=async()=>{I=void 0,ee=void 0},je=async(e,r)=>(O(),await I.mergeIndex(e,r)),Oe=async(e,r)=>(O(),await I.search(e,r)),Be=async(e,r,t=300)=>(O(),await I.debouncedSearch(e,r,t)),Ne=async(e,r)=>(O(),await I.preload(e,r)),ze=async()=>(O(),await I.filters());export{Be as debouncedSearch,qe as destroy,ze as filters,Ce as init,je as mergeIndex,Re as options,Ne as preload,Oe as search};
